# Гид: добавление гид-объектов (GuideObject) и отзывы

## 1. Название сценария
Гид: добавление гид-объектов и отзывы

## 2. Цель сценария
Позволить пользователям добавлять гид-объекты (GuideObject) (кафе, рестораны, отели, магазины, сервисные центры и др.), а также оставлять отзывы о них, чтобы формировать базу проверенных рекомендаций и повышать доверие внутри клуба.

## 3. Участники и роли
- Пользователь (с ролью member или выше, добавляет гид-объект, оставляет отзыв)
- Администратор (может удалять гид-объекты)
- Backend
- Telegram-бот

## 4. Предусловия
- Пользователь авторизован и имеет доступ к разделу "Гид".
- Пользователь (с ролью member или выше)

## 5. Основной поток (пошагово)
1. Пользователь открывает раздел "Гид" в приложении.
2. В правом нижнем углу отображается плавающая кнопка "+" (FAB) для добавления нового гид-объекта.
3. При нажатии на "+" открывается форма, где сначала выбирается тип гид-объекта (GuideObject) (кафе, ресторан, отель, магазин, сервисный центр, другое).
4. В зависимости от выбора отображаются соответствующие поля:
   - Название (обязательное)
   - Категория (обязательное)
   - Описание (опционально)
   - Фото/логотип (опционально)
   - Контакты, ссылки (опционально)
5. После заполнения обязательных полей пользователь может:
   - "Сохранить" — гид-объект сохраняется, появляется в списке, пользователь получает уведомление.
   - "Сохранить и оставить отзыв" — после сохранения открывается форма отзыва.
6. Оставление отзыва:
   - Три слайдера (качество, скорость, цена — по 10-балльной шкале, с градиентами и подписями)
   - Поле для текстового отзыва (обязательное)
   - Фото (опционально)
   - Отображаются средний балл и показатель "цена/качество" (см. формулы в черновике)
   - После добавления — отзыв появляется в карточке гид-объекта, пользователь получает уведомление.
7. В списке гид-объектов отображаются все добавленные элементы.
8. При нажатии на карточку гид-объекта открывается подробная информация, где пользователь может редактировать или удалить свой отзыв.
9. Администратор может удалить гид-объект (статус меняется на 'удалён').

## 6. Альтернативные потоки / Edge-cases
- Если пользователь пытается добавить дубликат гид-объекта — появляется подсказка.
- Если достигнут лимит на количество гид-объектов — кнопка "+" неактивна, появляется подсказка (лимит настраивается в config/app.config.ts).
- Если пользователь уже оставлял отзыв для этого гид-объекта — повторное добавление невозможно, разрешено только редактирование/удаление.
- Если профиль заблокирован — добавление/редактирование/удаление гид-объектов и отзывов недоступно.
- При удалении гид-объект помечается как 'удалён', но остаётся в базе.

## 7. Роли и статусы: переходы

> Для пользователя применяются только роли (см. docs/USER_ROLES.md). Для гид-объектов используются отдельные статусы (например, 'активен', 'удалён').
- Отзыв на гид-объект можно редактировать или удалить только своему автору.

## 8. UX-детали
- Кнопка "+" (FAB) всегда в правом нижнем углу.
- После "Сохранить и оставить отзыв" сразу открывается форма отзыва.
- Все поля гид-объекта валидируются в реальном времени.
- Слайдеры отзывов на гид-объект имеют градиенты и подписи (см. черновик).
- Средний балл и показатель "цена/качество" по гид-объекту считаются и отображаются в реальном времени.
- После добавления/редактирования/удаления гид-объекта пользователь остаётся в разделе и видит актуальный список.

## 9. Интеграции и API
- Backend: добавление, редактирование, удаление гид-объектов, отзывы
- API для загрузки фото, справочники категорий и типов гид-объектов
- Telegram-бот: уведомления о действиях с гид-объектами и отзывами

## 10. Уведомления
- Через Telegram-бота:
  - Гид-объект успешно добавлен
  - Отзыв успешно добавлен
  - Отзыв отредактирован/удалён
  - Гид-объект удалён (статус 'удалён')
  - Ошибки и лимиты

## 11. Ограничения и лимиты
- Лимит на количество гид-объектов на пользователя (см. config/app.config.ts)
- Без обязательных полей нельзя добавить/сохранить гид-объект
- Один пользователь — один отзыв на гид-объект
- Если профиль заблокирован — управление гид-объектами и отзывами недоступно
- Лимит: см. параметр `reviews.maxPerGuideObject` в [config/app.config.ts](../../config/app.config.ts)

## 12. Связанные сценарии и документы
- [Регистрация и первый вход](01_registration.md)
- [Схема БД: guide_objects, reviews](../DATABASE_SCHEMA.md)
- [API: /api/guide-objects, /api/reviews](../API_METHODS.md)
- [Уведомления](15_notifications.md)
- [Лимиты и параметры](../config/app.config.ts)

## 13. Тест-кейсы (минимум 3)
- Пользователь добавляет гид-объект, оставляет отзыв, оба элемента появляются в списке, пользователь получает уведомления.
- Пользователь пытается добавить дубликат гид-объекта — появляется подсказка, добавление невозможно.
- Пользователь редактирует или удаляет свой отзыв, изменения отображаются в карточке гид-объекта, появляется уведомление.
- При превышении лимита гид-объектов кнопка "+" неактивна, появляется подсказка.

---

> Все шаги и статусы согласованы с бизнес-логикой и схемой БД CabrioRide. UX-детали, лимиты и уведомления должны быть реализованы согласно этому сценарию. 

> Статусы пользователя см. в docs/USER_ROLES.md 