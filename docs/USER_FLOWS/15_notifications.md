# 15. Уведомления и шаблоны

## 1. Название сценария
Уведомления и шаблоны

## 2. Цель сценария
Обеспечить информирование пользователей о ключевых событиях, статусах, ошибках и действиях в системе CabrioRide через личные и групповые уведомления, а также централизованное управление шаблонами сообщений.

## 3. Участники и роли
- Пользователь (член клуба)
- Telegram-бот
- Админ/модератор (отправка/настройка уведомлений)

## 4. Предусловия
- Пользователь зарегистрирован в Telegram
- Пользователь совершает действия в приложении или боте

## 5. Основной поток (пошагово)
1. При наступлении события (регистрация, модерация, добавление авто, отзыв, respect и др.) backend инициирует отправку уведомления.
2. Telegram-бот отправляет личное уведомление пользователю (в личку) или групповое уведомление в клубный чат.
3. Все шаблоны уведомлений и их включение/выключение настраиваются в bot.config.ts.
4. Пользователь получает уведомление с пояснением, статусом, ссылкой или инструкцией (если применимо).

## 6. Альтернативные потоки / Edge-cases
- Если Telegram API недоступен — уведомление не отправляется, фиксируется ошибка.
- Если пользователь заблокировал бота — уведомление не доставляется, фиксируется ошибка.
- Если превышен лимит уведомлений — новые уведомления не отправляются до следующего дня (лимит настраивается).

## 7. Статусы и переходы
- Уведомления могут быть личными (в личку) или групповыми (в чат)
- Статус уведомления: отправлено / не доставлено / ошибка

## 8. UX-детали
- Все уведомления лаконичны, содержат статус, причину (если применимо), ссылку или инструкцию
- В личных уведомлениях — только релевантная информация для пользователя
- В групповых — только важные события (новый участник, авто, событие и др.)
- Все шаблоны централизованы и легко редактируются

## 9. Интеграции и API
- Telegram Bot API
- Backend: инициатор отправки уведомлений
- bot.config.ts — хранение и настройка шаблонов
- app.config.ts — лимиты и параметры

## 10. Уведомления
### Личные уведомления пользователю (бот в личку)
- Регистрация и модерация: профиль отправлен, одобрен, отклонён, заблокирован, возвращён на доработку
- Автомобили: добавлен, отредактирован, удалён, визитка
- События: добавлено, отредактировано, удалено, изменение статуса участия
- Отзывы: добавлен, отредактирован, удалён
- Respect: получен, достигнут лимит
- Визитки: успешно, ошибка, лимит
- Ошибки и лимиты: превышен лимит, ошибка распознавания, ошибка WebApp
- Системные: изменение роли/статуса, выход из клуба

### Групповые уведомления (бот в чат клуба)
- Приветствие новых участников
- Новое авто
- Новое событие
- Новый гид-объект (GuideObject)
- Визитка (опционально)

## 11. Ограничения и лимиты
- Все лимиты уведомлений настраиваются в app.config.ts
- Только для пользователей, состоящих в клубном чате
- Нет спама: групповые уведомления только по важным событиям
- Лимит: см. параметр `notifications.maxPerUserPerDay` в [config/app.config.ts](../../config/app.config.ts)

## 12. Связанные сценарии и документы
- [Работа с Telegram-ботом](11_telegram_bot.md)
- [Конфиг уведомлений бота](../config/bot.config.ts)
- [Лимиты и параметры](../config/app.config.ts)

## 13. Тест-кейсы (минимум 3)
- Пользователь получает уведомление о смене статуса профиля
- В клубный чат отправляется приветствие нового участника
- При ошибке Telegram API уведомление не доставляется, фиксируется ошибка 