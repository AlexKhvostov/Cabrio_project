# Добавление и управление событиями

## 1. Название сценария
Добавление и управление событиями

## 2. Цель сценария
Позволить пользователю создавать, редактировать и удалять события (мероприятия), участвовать в них, а также управлять своим статусом участия и видеть актуальную информацию о событиях клуба.

## 3. Участники и роли
- Пользователь
- Организатор события (пользователь)
- Backend
- Telegram-бот
- (Модератор/админ — косвенно, для контроля и удаления событий)

## 4. Предусловия
- Пользователь авторизован и имеет доступ к разделу "События".
- Пользователь (с ролью member или выше)

## 5. Основной поток (пошагово)
1. Пользователь открывает раздел "События" в приложении.
2. В правом нижнем углу отображается плавающая кнопка "+" (FAB) для добавления нового события.
3. При нажатии на "+" открывается форма добавления события:
   - Название события (обязательное)
   - Дата и время (обязательное, выбор через календарь/таймпикер)
   - Место проведения (обязательное, можно выбрать на карте или ввести вручную)
   - Описание (опционально)
   - Фото/обложка события (опционально)
   - Лимит участников (опционально)
   - Чекбокс "Сделать событие приватным" (опционально)
4. Пользователь заполняет обязательные поля и нажимает "Сохранить".
5. После успешного добавления:
   - Событие появляется в списке событий.
   - Пользователь становится организатором события.
   - Пользователь получает уведомление через Telegram-бот: «Событие успешно добавлено».
6. В списке событий отображаются все актуальные мероприятия.
7. При нажатии на событие открывается подробная карточка:
   - Если пользователь — организатор, доступны кнопки «Редактировать» и «Удалить».
   - При редактировании — поля становятся доступны для изменения, после сохранения — уведомление через Telegram-бот.
   - При удалении — событие помечается как 'удалён', пользователь получает уведомление.
8. При просмотре события пользователю задаётся вопрос: "Будете ли вы участвовать в этом мероприятии?"
   - Пользователь может выбрать один из вариантов: "Да", "Нет", "Возможно".
   - Если выбран вариант "Да", появляется возможность добавить +1 гостя (если это разрешено для события).
   - Ответ пользователя сохраняется, и он, а также организатор, получают соответствующее уведомление через Telegram-бот.
   - Пользователь может изменить свой ответ (статус участия) в любое время до начала события — для этого достаточно снова открыть карточку события и выбрать другой вариант.
   - В списке событий (на мини-карточке) всегда отображается текущий ответ пользователя по каждому мероприятию (например, иконка или текст: "Вы участвуете", "Вы не участвуете", "Возможно").

## 6. Альтернативные потоки / Edge-cases
- Если пользователь пытается создать событие с некорректными данными (например, дата в прошлом) — появляется подсказка.
- Если достигнут лимит на количество создаваемых событий — кнопка "+" неактивна, появляется подсказка (лимит настраивается в config/app.config.ts).
- Если событие уже началось или завершено — изменить статус участия нельзя, кнопки становятся неактивными.
- Если пользователь заблокирован — создание/редактирование/удаление/участие недоступно.
- При удалении событие помечается как 'удалён', но остаётся в базе.

## 7. Роли и статусы: переходы

> Для пользователя применяются только роли (см. docs/USER_ROLES.md). Для событий используются отдельные статусы (например, 'удалён').
- При создании события пользователь становится организатором.
- При удалении — статус события меняется на 'удалён' (статус события).
- Статус участия пользователя: "Да", "Возможно", "Нет", +1 гость (флаг plus_one). Это не роль пользователя, а отдельное поле.

## 8. UX-детали
- Кнопка "+" (FAB) всегда видна в правом нижнем углу раздела "События".
- Редактирование и удаление доступны только для своих событий и только из подробной карточки.
- После добавления/редактирования/удаления события пользователь остаётся в разделе "События" и видит актуальный список.
- Все поля валидируются в реальном времени.
- Под незаполненными полями — подсказки.
- В карточке события всегда виден статус пользователя и его можно изменить до начала события.
- В списке событий на мини-карточке отображается текущий ответ пользователя.

## 9. Интеграции и API
- Backend: добавление, редактирование, удаление событий, управление участниками
- API для загрузки фото, справочники типов событий
- Telegram-бот: уведомления о действиях с событиями и статусах участия

## 10. Уведомления
- Через Telegram-бота:
  - Событие успешно добавлено
  - Событие отредактировано
  - Событие удалено (статус 'удалён')
  - Изменение статуса участия (уведомление организатору)
  - Ошибки и лимиты

## 11. Ограничения и лимиты
- Лимит на количество создаваемых событий на пользователя (см. config/app.config.ts)
- Без обязательных полей нельзя добавить/сохранить событие
- Если профиль заблокирован — управление событиями недоступно
- Изменять статус участия можно только до начала события
- Лимит: см. параметр `events.maxPerUser` в [config/app.config.ts](../../config/app.config.ts)

## 12. Связанные сценарии и документы
- [Регистрация и первый вход](01_registration.md)
- [Редактирование профиля](02_profile_edit.md)
- [Схема БД: events, link_event_participants](../DATABASE_SCHEMA.md)
- [API: /api/events](../API_METHODS.md)
- [Уведомления](15_notifications.md)

## 13. Тест-кейсы (минимум 3)
- Пользователь создаёт событие, оно появляется в списке, пользователь становится организатором, получает уведомление.
- Пользователь меняет свой статус участия, организатор получает уведомление, статус отображается в карточке события.
- При удалении события оно помечается как 'удалён', но остаётся в базе.
- При превышении лимита событий кнопка "+" неактивна, появляется подсказка.

---

> Все шаги и статусы согласованы с бизнес-логикой и схемой БД CabrioRide. UX-детали и уведомления должны быть реализованы согласно этому сценарию. 