# Редактирование профиля

## 1. Название сценария
Редактирование профиля

## 2. Цель сценария
Позволить пользователю актуализировать свои данные, поддерживать профиль в актуальном состоянии без необходимости повторной модерации после получения роли member.

## 3. Участники и роли
- Пользователь (с ролью member или выше)
- Backend

## 4. Предусловия
- Пользователь авторизован и имеет доступ к разделу "Профиль".
- Роль пользователя — member, moderator или admin.

## 5. Основной поток (пошагово)
1. Пользователь открывает раздел "Профиль" (через меню или иконку-карандаш).
2. Все поля анкеты доступны для редактирования (имя, фамилия, город, страна, email, телефон, о себе, username, Instagram, дата рождения, фото и т.д.).
3. Если у пользователя есть авто — доступен блок управления автомобилями. Если нет — блок "С кем катаетесь".
4. При изменении любого поля:
   - Прогрессбар заполнения профиля пересчитывается (см. [схему развесовки](profile_weights.md)).
   - Если заполнено >50% — кнопка "Сохранить" становится активной.
5. После нажатия "Сохранить":
   - Профиль сохраняется.
   - Пользователь видит сообщение "Профиль обновлён".

## 6. Альтернативные потоки / Edge-cases
- Если пользователь не заполнил обязательные поля — кнопка "Сохранить" неактивна, отображается список незаполненных полей.
- Если роль пользователя была понижена вручную (например, до registered), для возврата к member требуется повторная модерация (см. отдельный сценарий).
- Если роль external — он не имеету доустпа к приложению

## 7. Переходы ролей
- После получения роли member пользователь может свободно редактировать профиль без повторной модерации.
- Если роль понижена вручную (например, до registered), возврат к member возможен только после повторной модерации (см. сценарий модерации).

## 8. UX-детали
- Все поля валидируются в реальном времени.
- Прогрессбар заполнения профиля всегда виден (см. [profile_weights.md](profile_weights.md)).
- Под незаполненными вопросами — подсказки.
- После сохранения — короткое сообщение и возврат к профилю.
- Кнопка "Сохранить" активна только при заполнении >50% анкеты.

## 9. Интеграции и API
- Backend: обновление профиля
- API для загрузки фото, справочники авто

## 10. Уведомления
- Через Telegram-бота:
  - Профиль обновлён
  - Ошибки и лимиты

## 11. Ограничения и лимиты
- Без заполнения обязательных полей и >50% прогресса нельзя сохранить профиль
- Если роль external — редактирование недоступно

## 12. Связанные сценарии и документы
- [Регистрация и первый вход](registration.md)
- [Модерация профиля](admin_tools.md)
- [Схема развесовки анкеты](profile_weights.md)
- [Схема БД: users, cars, link_user_cars](../DATABASE_SCHEMA.md)

## 13. Тест-кейсы (минимум 3)
- Пользователь с ролью member редактирует профиль, заполняет >50% анкеты, сохраняет изменения, видит сообщение об успешном обновлении.
- Пользователь не может сохранить профиль, если не заполнены обязательные поля.
- Если роль external — редактирование недоступно, отображается причина.
- Если роль понижена вручную — возврат к member возможен только после повторной модерации (см. отдельный сценарий).

---

> Все шаги и переходы ролей согласованы с бизнес-логикой и схемой БД CabrioRide. UX-детали и уведомления должны быть реализованы согласно этому сценарию. 