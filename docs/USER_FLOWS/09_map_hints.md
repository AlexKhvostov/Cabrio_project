# 9. Подсказки на карте

## 1. Название сценария
Подсказки на карте

## 2. Цель сценария
Позволить пользователям оперативно делиться информацией о дорожных событиях (ГАИ, ремонт, пробка, авария) через временные метки на карте CabrioRide. Повысить информированность и безопасность участников.

## 3. Участники и роли
- Пользователь (member или выше: member, moderator, admin)
- Модератор/админ (расширенные права на удаление)

## 4. Предусловия
- Пользователь авторизован и имеет роль member или выше (member, moderator, admin)
- Включена геолокация (если требуется для добавления метки)

## 5. Основной поток (пошагово)
1. Пользователь с ролью member или выше открывает раздел "Карта".
2. Нажимает кнопку "Добавить подсказку".
3. Выбирает тип подсказки ("ГАИ", "ремонт", "пробка", "авария").
4. Подсказка появляется на карте у всех участников.
5. Метка автоматически исчезает через 1 час.
6. Автор метки или модератор/админ может удалить метку двойным нажатием.
7. В базе сохраняется информация о том, кто поставил и кто удалил метку (если применимо).

## 6. Альтернативные потоки / Edge-cases
- Если пользователь не дал разрешение на геолокацию — подсказка не добавляется, появляется уведомление.
- Если пользователь не имеет роль member или выше — функция недоступна.
- Если метка не удалена вручную — исчезает автоматически через 1 час.
- Если модератор/админ удаляет чужую метку — фиксируется в логах.

## 7. Роли и статусы: переходы

> Для пользователя применяются только роли (см. docs/USER_ROLES.md). Для меток используются отдельные статусы (например, 'активна', 'удалена').
- Только пользователи с ролью member или выше (member, moderator, admin) могут добавлять подсказки
- Метка: активна → удалена (manual) → удалена (auto)

## 8. UX-детали
- Кнопка "Добавить подсказку" всегда видна на карте (только для member или выше)
- После добавления метки — анимация появления
- При удалении — плавное исчезновение
- Цвет/иконка метки зависит от типа (ГАИ, ремонт и т.д.)
- При попытке добавить без геолокации — всплывающее предупреждение

## 9. Интеграции и API
- API для добавления/удаления подсказки
- Сохранение в базе: кто поставил, когда, тип, координаты
- [API: методы работы с подсказками](../API_METHODS.md)

## 10. Уведомления
- Нет персональных уведомлений, только визуальные изменения на карте
- (Опционально) — уведомление модератору о массовом удалении

## 11. Ограничения и лимиты
- Только для пользователей с ролью member или выше (member, moderator, admin)
- Метка живёт 1 час
- Одновременно можно добавить не более N меток (лимит в конфиге)
- Лимит: см. параметр `mapHints.maxPerUser` в [config/app.config.ts](../../config/app.config.ts)

## 12. Связанные сценарии и документы
- [Использование раздела "Карта"](07_map.md)
- [Роли пользователя](../USER_ROLES.md)
- [API: методы работы с подсказками](../API_METHODS.md)

## 13. Тест-кейсы (минимум 3)
- Пользователь с ролью member или выше добавляет подсказку, она появляется у всех и исчезает через 1 час
- Пользователь без геолокации пытается добавить подсказку — получает предупреждение
- Модератор удаляет чужую метку, действие фиксируется в логах 