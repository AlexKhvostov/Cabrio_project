# 13. Выход из клуба и блокировка

## 1. Название сценария
Выход из клуба и блокировка

## 2. Цель сценария
Обеспечить корректную обработку выхода пользователя из клубного Telegram-чата или его блокировки, с сохранением истории и безопасным ограничением доступа к приложению.

## 3. Участники и роли
- Пользователь (член клуба)
- Модератор/админ (может удалить или заблокировать пользователя)
- Telegram-бот
- Backend приложения

## 4. Предусловия
- Пользователь зарегистрирован в Telegram
- Пользователь был активен в приложении и состоял в клубном чате

## 5. Основной поток (пошагово)
1. Пользователь вручную покидает клубный Telegram-чат или его удаляет модератор/админ.
2. При любой активности в приложении backend проверяет членство в чате через Telegram API.
3. Если пользователь больше не состоит в чате:
   - В базе статус пользователя меняется на left.
   - Пользователь теряет доступ ко всем разделам приложения.
   - На экране появляется заглушка с объяснением и ссылкой на чат.
4. Если пользователь снова вступает в чат, при следующей проверке статус обновляется, доступ восстанавливается.
5. Все данные пользователя и связанные сущности (авто, отзывы, события) сохраняются в базе для истории и аудита.

## 6. Альтернативные потоки / Edge-cases
- Если пользователь был удалён из чата модератором — причина фиксируется в логах модерации.
- Если пользователь пытается войти с тем же Telegram-аккаунтом — видит заглушку с объяснением.
- Если Telegram API временно недоступен — показывается сообщение об ошибке.
- Если пользователь возвращается в чат — статус становится active, доступ восстанавливается.

## 7. Статусы и переходы
- Пользователь: active → left (при выходе из чата)
- При возвращении в чат — статус снова active
- Все автомобили пользователя получают статус left и скрываются из публичных разделов

## 8. UX-детали
- Заглушка с объяснением и ссылкой на чат
- Проверка членства происходит автоматически
- После возвращения в чат доступ восстанавливается без лишних действий

## 9. Интеграции и API
- Telegram Bot API
- Проверка членства через Telegram API
- Backend: смена статусов пользователя и связанных сущностей
- Логи модерации

## 10. Уведомления
- Личные уведомления о смене статуса (left)
- Сообщения об ошибках (недоступен Telegram API)
- Причина удаления фиксируется в логах (если применимо)

## 11. Ограничения и лимиты
- Доступ к приложению только для участников чата
- Все данные сохраняются для истории и аудита
- Нет возможности удалить профиль полностью через интерфейс

## 12. Связанные сценарии и документы
- [Авторизация и вход через Telegram](12_authorization.md)
- [Работа с Telegram-ботом](11_telegram_bot.md)
- [Роли и статусы](../USER_ROLES_STATUSES.md)

## 13. Тест-кейсы (минимум 3)
- Пользователь выходит из чата — статус меняется на left, доступ блокируется, появляется заглушка
- Пользователь возвращается в чат — статус становится active, доступ восстанавливается
- Модератор удаляет пользователя из чата, причина фиксируется в логах 