# 10. Система respect (кристаллы)

## 1. Название сценария
Система respect (кристаллы)

## 2. Цель сценария
Ввести внутреннюю систему "кристаллов" (respect) для поощрения и ранжирования участников клуба CabrioRide, стимулировать активность и поддерживать здоровую атмосферу.

## 3. Участники и роли
- Пользователь (user)
- Модератор, админ, root (контроль лимитов, просмотр логов)

## 4. Предусловия
- Пользователь активен (статус active)
- Доступен профиль другого участника

## 5. Основной поток (пошагово)
1. После регистрации пользователь получает 24 respect (кристалла).
2. Пользователь может поставить respect другому участнику (но не себе) через кнопку на карточке профиля.
3. Кнопка respect активна, если:
   - Это не свой профиль
   - Сегодня respect этому участнику ещё не ставился
   - Не превышен дневной лимит (по умолчанию — 5 респектов разным людям в сутки)
4. При нажатии:
   - У выбранного пользователя увеличивается respect (максимум 255)
   - У инициатора уменьшается лимит на сегодня
   - Кнопка становится неактивной для этого пользователя до следующего дня
5. Каждый день в полночь у всех пользователей автоматически сгорает 2 respect (если есть)

## 6. Влияние respect
- На старте проекта количество respect влияет только на сортировку участников в списке и отображение в профиле (визуализация кристаллов).
- В будущем возможно расширение механики: respect может стать условием для доступа к отдельным функциям, привилегиям или влиять на вес отзывов.
- Решение о таком расширении будет приниматься после запуска приложения и анализа реального поведения пользователей: насколько востребована система respect, как активно ей пользуются и есть ли смысл делать её частью доступа к дополнительным возможностям.

## 7. Respect за активности пользователя
Respect начисляется не только за действия других участников, но и за ключевые активности пользователя:
- Регистрация (создание профиля): respect начисляется один раз при регистрации.
- Первая активация профиля: respect начисляется только один раз — в момент, когда пользователь получает роль 'user' после модерации.
- Добавление автомобиля: respect начисляется за каждое добавление авто, при удалении авто respect вычитается на ту же сумму.
- Указание основного гостя: respect начисляется за каждого нового гостя, при удалении гостя respect вычитается на ту же сумму.
- Добавление события: respect начисляется за каждое добавление события, при удалении respect вычитается.
- Добавление отзыва: respect начисляется за каждый новый отзыв, при удалении respect вычитается.
- Добавление объекта (гид): respect начисляется за каждый новый объект, при удалении respect вычитается.

Все значения наград централизованно настраиваются в параметрах `activityRewards` в [config/app.config.ts](../../config/app.config.ts).

## 7. Альтернативные потоки / Edge-cases
- Себе поставить respect нельзя
- В день можно поставить respect максимум 5 разным людям
- Одному и тому же человеку — только 1 раз в сутки
- Если достигнут максимум respect (255) — новые не начисляются
- Если у пользователя меньше 2 respect — после сгорания становится 0
- Respect сгорают независимо от активности
- Если лимит respect на день исчерпан — кнопка неактивна до следующего дня

## 8. Статусы и переходы
- Respect: увеличивается при получении, уменьшается при сгорании
- Кнопка respect: активна/неактивна в зависимости от лимитов и условий

## 9. UX-детали
- Кнопка respect (иконка кристалла) видна только на чужих карточках
- Цвет кристалла насыщается по мере роста respect
- Значение respect отображается округлённо (например, "10+", "120+")
- Кнопка становится неактивной при исчерпании лимита или попытке поставить себе
- Нет уведомлений о том, кто поставил respect

## 10. Интеграции и API
- Поле respect в таблице users (TINYINT UNSIGNED, default: 24, max: 255)
- Таблица respect_logs (id, from_user_id, to_user_id, created_at)
- Проверка лимитов и истории через respect_logs
- Все параметры системы respect настраиваются в config/app.config.ts

## 11. Уведомления
- Пользователь получает уведомление о получении respect
- Уведомление о достижении лимита respect на сегодня
- Нет уведомлений о том, кто поставил respect

## 12. Ограничения и лимиты
- Себе поставить respect нельзя
- В день максимум 5 respect разным людям (настраивается)
- Одному человеку — 1 раз в сутки
- Максимум respect — 255, минимум — 0
- Respect сгорают ежедневно (минус 2)
- Лимит: см. параметр `respect.maxPerDay` в [config/app.config.ts](../../config/app.config.ts)

## 13. Связанные сценарии и документы
- [Роли и статусы](../USER_ROLES_STATUSES.md)
- [Конфиг лимитов](../config/app.config.ts)
- [Сортировка участников](03_car_management.md)

## 14. Тест-кейсы (минимум 3)
- Пользователь ставит respect другому участнику, значение увеличивается, кнопка становится неактивной
- В полночь у пользователя с respect >2 значение уменьшается на 2
- Пользователь пытается поставить respect себе — кнопка неактивна 